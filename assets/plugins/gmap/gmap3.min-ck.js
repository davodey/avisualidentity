/*!
 *  GMAP3 Plugin for JQuery
 *  Version   : 5.1.1
 *  Date      : 2013-05-25
 *  Licence   : GPL v3 : http://www.gnu.org/licenses/gpl.html
 *  Author    : DEMONTE Jean-Baptiste
 *  Contact   : jbdemonte@gmail.com
 *  Web site  : http://gmap3.net
 */(function(e,t){function n(e,n){return e!==t?e:"gmap3_"+(n?L+1:++L)}function r(e){var t=function(e){return parseInt(e,10)},n=google.maps.version.split(".").map(t);e=e.split(".").map(t);for(t=0;t<e.length;t++){if(!n.hasOwnProperty(t))return!1;if(n[t]<e[t])return!1}return!0}function i(t,n,r,i,s){if(n.todo.events||n.todo.onces){var o={id:i,data:n.todo.data,tag:n.todo.tag};n.todo.events&&e.each(n.todo.events,function(n,i){var u=t,a=i;e.isArray(i)&&(u=i[0],a=i[1]);google.maps.event.addListener(r,n,function(e){a.apply(u,[s?s:r,e,o])})});n.todo.onces&&e.each(n.todo.onces,function(n,i){var u=t,a=i;e.isArray(i)&&(u=i[0],a=i[1]);google.maps.event.addListenerOnce(r,n,function(e){a.apply(u,[s?s:r,e,o])})})}}function s(){var e=[];this.empty=function(){return!e.length};this.add=function(t){e.push(t)};this.get=function(){return e.length?e[0]:!1};this.ack=function(){e.shift()}}function o(t,n,r){function i(e){var t={};t[e]={};return t}function s(){for(var e in r)if(!(e in o))return e}var o={},u=this,a,f={map:!1,marker:!1,infowindow:!1,circle:!1,overlay:!1,getlatlng:!1,getmaxzoom:!1,getelevation:!1,streetviewpanorama:!1,getaddress:!0},l={getgeoloc:!0};"string"==typeof r&&(r=i(r));this.run=function(){for(var i,u;i=s();){if("function"==typeof t[i]){a=i;u=e.extend(!0,{},k[i]||{},r[i].options||{});i in f?r[i].values?x(r[i].values,t,t[i],{todo:r[i],opts:u,session:o}):S(t,t[i],f[i],{todo:r[i],opts:u,session:o}):i in l?T(t,t[i],{todo:r[i],opts:u,session:o}):t[i].apply(t,[{todo:r[i],opts:u,session:o}]);return}o[i]=null}n.apply(t,[r,o])};this.ack=function(e){o[a]=e;u.run.apply(u,[])}}function u(e){var t,n=[];for(t in e)n.push(t);return n}function a(t,n){var r={};if(t.todo)for(var i in t.todo)"options"!==i&&"values"!==i&&(r[i]=t.todo[i]);var s=["data","tag","id","events","onces"];for(i=0;i<s.length;i++)f(r,s[i],n,t.todo);r.options=e.extend({},t.opts||{},n.options||{});return r}function f(e,t){for(var n=2;n<arguments.length;n++)if(t in arguments[n]){e[t]=arguments[n][t];break}}function l(t,n,r,i){var s=this,o=[];k.classes.OverlayView.call(this);this.setMap(t);this.onAdd=function(){var t=this.getPanes();n.pane in t&&e(t[n.pane]).append(i);e.each("dblclick click mouseover mousemove mouseout mouseup mousedown".split(" "),function(t,n){o.push(google.maps.event.addDomListener(i[0],n,function(t){e.Event(t).stopPropagation();google.maps.event.trigger(s,n,[t]);s.draw()}))});o.push(google.maps.event.addDomListener(i[0],"contextmenu",function(t){e.Event(t).stopPropagation();google.maps.event.trigger(s,"rightclick",[t]);s.draw()}))};this.getPosition=function(){return r};this.draw=function(){var e=this.getProjection().fromLatLngToDivPixel(r);i.css("left",e.x+n.offset.x+"px").css("top",e.y+n.offset.y+"px")};this.onRemove=function(){for(var e=0;e<o.length;e++)google.maps.event.removeListener(o[e]);i.remove()};this.hide=function(){i.hide()};this.show=function(){i.show()};this.toggle=function(){i&&(i.is(":visible")?this.show():this.hide())};this.toggleDOM=function(){this.getMap()?this.setMap(null):this.setMap(t)};this.getDOMElement=function(){return i[0]}}function c(e,t){function n(){this.onAdd=function(){};this.onRemove=function(){};this.draw=function(){};return k.classes.OverlayView.apply(this,[])}n.prototype=k.classes.OverlayView.prototype;var r=new n;r.setMap(e);return r}function h(t,r,s){function o(e){C[e]||(delete L[e].options.map,C[e]=new k.classes.Marker(L[e].options),i(t,{todo:L[e]},C[e],L[e].id))}function u(){(_=O.getProjection())?(y=!0,S.push(google.maps.event.addListener(r,"zoom_changed",function(){h()})),S.push(google.maps.event.addListener(r,"bounds_changed",function(){h()})),d()):setTimeout(function(){u.apply(E,[])},25)}function a(e){"object"==typeof x[e]?("function"==typeof x[e].obj.setMap&&x[e].obj.setMap(null),"function"==typeof x[e].obj.remove&&x[e].obj.remove(),"function"==typeof x[e].shadow.remove&&x[e].obj.remove(),"function"==typeof x[e].shadow.setMap&&x[e].shadow.setMap(null),delete x[e].obj,delete x[e].shadow):C[e]&&C[e].setMap(null);delete x[e]}function f(){var e;e=r.getCenter();var t=r.getBounds().getNorthEast(),n,i;e instanceof google.maps.LatLng?(n=e.lat(),i=e.lng(),t instanceof google.maps.LatLng?(e=t.lat(),t=t.lng()):(e=t,t=void 0)):(n=e,i=t,t=e=void 0);n=Math.PI*n/180;i=Math.PI*i/180;e=Math.PI*e/180;t=Math.PI*t/180;e=6371e3*Math.acos(Math.min(Math.cos(n)*Math.cos(e)*Math.cos(i)*Math.cos(t)+Math.cos(n)*Math.sin(i)*Math.cos(e)*Math.sin(t)+Math.sin(n)*Math.sin(e),1));return(new google.maps.Circle({center:r.getCenter(),radius:1.25*e})).getBounds()}function l(){var e={},t;for(t in x)e[t]=!0;return e}function h(){clearTimeout(M);M=setTimeout(function(){d()},25)}function p(e){var t=_.fromLatLngToDivPixel(e);e=_.fromDivPixelToLatLng(new google.maps.Point(t.x+s.radius,t.y-s.radius));t=_.fromDivPixelToLatLng(new google.maps.Point(t.x-s.radius,t.y+s.radius));return new google.maps.LatLngBounds(t,e)}function d(){if(!v&&!g&&y){var t=[],n={},i=r.getZoom(),o="maxZoom"in s&&i>s.maxZoom,u=l(),c,h;h=!1;var d,b,E;m=!1;3<i&&(d=f(),h=d.getSouthWest().lng()<d.getNorthEast().lng());for(i=0;i<L.length;i++)!L[i]||h&&!d.contains(L[i].options.position)||D&&!D(A[i])||t.push(i);for(;;){for(i=0;n[i]&&i<t.length;)i++;if(i==t.length)break;h=[];if(w&&!o){E=10;do for(b=h,h=[],E--,d=b.length?d.getCenter():L[t[i]].options.position,d=p(d),c=i;c<t.length;c++)n[c]||d.contains(L[t[c]].options.position)&&h.push(c);while(b.length<h.length&&1<h.length&&E)}else for(c=i;c<t.length;c++)if(!n[c]){h.push(c);break}b={indexes:[],ref:[]};for(i=E=c=0;i<h.length;i++)n[h[i]]=!0,b.indexes.push(t[h[i]]),b.ref.push(t[h[i]]),E+=L[t[h[i]]].options.position.lat(),c+=L[t[h[i]]].options.position.lng();E/=h.length;c/=h.length;b.latLng=new google.maps.LatLng(E,c);b.ref=b.ref.join("-");b.ref in u?delete u[b.ref]:(1===h.length&&(x[b.ref]=!0),P(b))}e.each(u,function(e){a(e)});g=!1}}var v=!1,m=!1,g=!1,y=!1,w=!0,E=this,S=[],x={},T={},N={},C=[],L=[],A=[],O=c(r,s.radius),M,_,D,P;u();this.getById=function(e){return e in T?(o(T[e]),C[T[e]]):!1};this.rm=function(e){var t=T[e];C[t]&&C[t].setMap(null);delete C[t];C[t]=!1;delete L[t];L[t]=!1;delete A[t];A[t]=!1;delete T[e];delete N[t];m=!0};this.clearById=function(e){if(e in T)return this.rm(e),!0};this.clear=function(e,t,n){var r,i,s=[],o=b(n);e?(r=L.length-1,i=n=-1):(r=0,n=L.length,i=1);for(;r!=n&&(!L[r]||o&&!o(L[r].tag)||(s.push(N[r]),!t&&!e));r+=i);for(e=0;e<s.length;e++)this.rm(s[e])};this.add=function(e,t){e.id=n(e.id);this.clearById(e.id);T[e.id]=C.length;N[C.length]=e.id;C.push(null);L.push(e);A.push(t);m=!0};this.addMarker=function(e,r){r=r||{};r.id=n(r.id);this.clearById(r.id);r.options||(r.options={});r.options.position=e.getPosition();i(t,{todo:r},e,r.id);T[r.id]=C.length;N[C.length]=r.id;C.push(e);L.push(r);A.push(r.data||{});m=!0};this.todo=function(e){return L[e]};this.value=function(e){return A[e]};this.marker=function(e){return e in C?(o(e),C[e]):!1};this.markerIsSet=function(e){return Boolean(C[e])};this.setMarker=function(e,t){C[e]=t};this.store=function(e,t,n){x[e.ref]={obj:t,shadow:n}};this.free=function(){for(var t=0;t<S.length;t++)google.maps.event.removeListener(S[t]);S=[];e.each(x,function(e){a(e)});x={};e.each(L,function(e){L[e]=null});L=[];e.each(C,function(e){C[e]&&(C[e].setMap(null),delete C[e])});C=[];e.each(A,function(e){delete A[e]});A=[];T={};N={}};this.filter=function(e){D=e;d()};this.enable=function(e){w!=e&&(w=e,d())};this.display=function(e){P=e};this.error=function(e){};this.beginUpdate=function(){v=!0};this.endUpdate=function(){v=!1;m&&d()};this.autofit=function(e){for(var t=0;t<L.length;t++)L[t]&&e.extend(L[t].options.position)}}function p(e,t){this.id=function(){return e};this.filter=function(e){t.filter(e)};this.enable=function(){t.enable(!0)};this.disable=function(){t.enable(!1)};this.add=function(e,n,r){r||t.beginUpdate();t.addMarker(e,n);r||t.endUpdate()};this.getById=function(e){return t.getById(e)};this.clearById=function(e,n){var r;n||t.beginUpdate();r=t.clearById(e);n||t.endUpdate();return r};this.clear=function(e,n,r,i){i||t.beginUpdate();t.clear(e,n,r);i||t.endUpdate()}}function d(){function r(e){return{id:e.id,name:e.name,object:e.obj,tag:e.tag,data:e.data}}function i(e){"function"==typeof e.setMap&&e.setMap(null);"function"==typeof e.remove&&e.remove();"function"==typeof e.free&&e.free()}var s={},o={};this.add=function(e,t,r,i){e=e.todo||{};var u=n(e.id);s[t]||(s[t]=[]);u in o&&this.clearById(u);o[u]={obj:r,sub:i,name:t,id:u,tag:e.tag,data:e.data};s[t].push(u);return u};this.getById=function(e,t,n){return e in o?t?o[e].sub:n?r(o[e]):o[e].obj:!1};this.get=function(e,t,n,i){var u,a=b(n);if(!s[e]||!s[e].length)return null;for(n=s[e].length;n;)if(n--,(u=s[e][t?n:s[e].length-n-1])&&o[u]&&(!a||a(o[u].tag)))return i?r(o[u]):o[u].obj;return null};this.all=function(e,n,i){var u=[],a=b(n);n=function(e){var t,n;for(t=0;t<s[e].length;t++)(n=s[e][t])&&o[n]&&(!a||a(o[n].tag))&&u.push(i?r(o[n]):o[n].obj)};if(e in s)n(e);else if(e===t)for(e in s)n(e);return u};this.rm=function(e,t,n){var r;if(!s[e])return!1;if(t)if(n)for(n=s[e].length-1;0<=n&&(r=s[e][n],!t(o[r].tag));n--);else for(n=0;n<s[e].length&&(r=s[e][n],!t(o[r].tag));n++);else n=n?s[e].length-1:0;return n in s[e]?this.clearById(s[e][n],n):!1};this.clearById=function(e,n){if(e in o){var r,u=o[e].name;for(r=0;n===t&&r<s[u].length;r++)e===s[u][r]&&(n=r);i(o[e].obj);o[e].sub&&i(o[e].sub);delete o[e];s[u].splice(n,1);return!0}return!1};this.objGetById=function(e){var t;if(s.clusterer)for(var n in s.clusterer)if(!1!==(t=o[s.clusterer[n]].obj.getById(e)))return t;return!1};this.objClearById=function(e){if(s.clusterer)for(var t in s.clusterer)if(o[s.clusterer[t]].obj.clearById(e))return!0;return null};this.clear=function(e,t,n,r){var i,o;r=b(r);if(e&&e.length)e=y(e);else for(i in e=[],s)e.push(i);for(i=0;i<e.length;i++)if(o=e[i],t)this.rm(o,r,!0);else if(n)this.rm(o,r,!1);else for(;this.rm(o,r,!1););};this.objClear=function(t,n,r,i){if(s.clusterer&&(0<=e.inArray("marker",t)||!t.length))for(var u in s.clusterer)o[s.clusterer[u]].obj.clear(n,r,i)}}function v(){A.elevationService||(A.elevationService=new google.maps.ElevationService);return A.elevationService}function m(){if(k.verbose){var e,t=[];if(window.console&&"function"==typeof console.error){for(e=0;e<arguments.length;e++)t.push(arguments[e]);console.error.apply(console,t)}else{t="";for(e=0;e<arguments.length;e++)t+=arguments[e].toString()+" ";alert(t)}}}function g(e){return("number"==typeof e||"string"==typeof e)&&""!==e&&!isNaN(e)}function y(e){var n,r=[];if(e!==t)if("object"==typeof e)if("number"==typeof e.length)r=e;else for(n in e)r.push(e[n]);else r.push(e);return r}function b(n){if(n){if("function"==typeof n)return n;n=y(n);return function(r){if(r===t)return!1;if("object"==typeof r){for(var i=0;i<r.length;i++)if(0<=e.inArray(r[i],n))return!0;return!1}return 0<=e.inArray(r,n)}}}function w(t,n,r){n=n?t:null;return t&&"string"!=typeof t?t.latLng?w(t.latLng):t instanceof google.maps.LatLng?t:g(t.lat)?new google.maps.LatLng(t.lat,t.lng):!r&&e.isArray(t)?g(t[0])&&g(t[1])?new google.maps.LatLng(t[0],t[1]):n:n:n}function E(t){var n,r;if(!t||t instanceof google.maps.LatLngBounds)return t||null;e.isArray(t)?2==t.length?(n=w(t[0]),r=w(t[1])):4==t.length&&(n=w([t[0],t[1]]),r=w([t[2],t[3]])):"ne"in t&&"sw"in t?(n=w(t.ne),r=w(t.sw)):"n"in t&&"e"in t&&"s"in t&&"w"in t&&(n=w([t.n,t.e]),r=w([t.s,t.w]));return n&&r?new google.maps.LatLngBounds(r,n):null}function S(e,t,n,r,i){var s=n?w(r.todo,!1,!0):!1,o=s?{latLng:s}:r.todo.address?"string"==typeof r.todo.address?{address:r.todo.address}:r.todo.address:!1,s=o?O.get(o):!1,u=this;o?(i=i||0,s?(r.latLng=s.results[0].geometry.location,r.results=s.results,r.status=s.status,t.apply(e,[r])):(o.location&&(o.location=w(o.location)),o.bounds&&(o.bounds=E(o.bounds)),A.geocoder||(A.geocoder=new google.maps.Geocoder),A.geocoder.geocode(o,function(s,a){a===google.maps.GeocoderStatus.OK?(O.store(o,{results:s,status:a}),r.latLng=s[0].geometry.location,r.results=s,r.status=a,t.apply(e,[r])):a===google.maps.GeocoderStatus.OVER_QUERY_LIMIT&&i<k.queryLimit.attempt?setTimeout(function(){S.apply(u,[e,t,n,r,i+1])},k.queryLimit.delay+Math.floor(Math.random()*k.queryLimit.random)):(m("geocode failed",a,o),r.latLng=r.results=!1,r.status=a,t.apply(e,[r]))}))):(r.latLng=w(r.todo,!1,!0),t.apply(e,[r]))}function x(t,n,r,i){function s(){do u++;while(u<t.length&&!("address"in t[u]));u>=t.length?r.apply(n,[i]):S(o,function(n){delete n.todo;e.extend(t[u],n);s.apply(o,[])},!0,{todo:t[u]})}var o=this,u=-1;s()}function T(e,t,n){var r=!1;navigator&&navigator.geolocation?navigator.geolocation.getCurrentPosition(function(i){r||(r=!0,n.latLng=new google.maps.LatLng(i.coords.latitude,i.coords.longitude),t.apply(e,[n]))},function(){r||(r=!0,n.latLng=!1,t.apply(e,[n]))},n.opts.getCurrentPosition):(n.latLng=!1,t.apply(e,[n]))}function N(u){function f(){!M&&(M=C.get())&&M.run()}function c(){M=null;C.ack();f.call(N)}function g(t){if(t.todo.callback){var n=Array.prototype.slice.call(arguments,1);"function"==typeof t.todo.callback?t.todo.callback.apply(u,n):e.isArray(t.todo.callback)&&"function"==typeof t.todo.callback[1]&&t.todo.callback[1].apply(t.todo.callback[0],n)}}function b(e,t,n){n&&i(u,e,t,n);g(e,t);M.ack(t)}function S(t,n){n=n||{};if(O)n.todo&&n.todo.options&&(n.todo.options.center&&(n.todo.options.center=w(n.todo.options.center)),O.setOptions(n.todo.options));else{var r=n.opts||e.extend(!0,{},k.map,n.todo&&n.todo.options?n.todo.options:{});r.center=t||w(r.center);O=new k.classes.Map(u.get(0),r)}}function x(t,n,r){var s=[],o="values"in t.todo;o||(t.todo.values=[{options:t.opts}]);t.todo.values.length?(S(),e.each(t.todo.values,function(o,f){var l,c,h=a(t,f);if(h.options[r])if(h.options[r][0][0]&&e.isArray(h.options[r][0][0]))for(l=0;l<h.options[r].length;l++)for(c=0;c<h.options[r][l].length;c++)h.options[r][l][c]=w(h.options[r][l][c]);else for(l=0;l<h.options[r].length;l++)h.options[r][l]=w(h.options[r][l]);h.options.map=O;c=new google.maps[n](h.options);s.push(c);l=L.add({todo:h},n.toLowerCase(),c);i(u,{todo:h},c,l)}),b(t,o?s:s[0])):b(t,!1)}function T(n){var r=new h(u,O,n),s={},o={},a=[],f=/^[0-9]+$/,l,c;for(c in n)f.test(c)?(a.push(1*c),o[c]=n[c],o[c].width=o[c].width||0,o[c].height=o[c].height||0):s[c]=n[c];a.sort(function(e,t){return e>t});l=s.calculator?function(t){var n=[];e.each(t,function(e,t){n.push(r.value(t))});return s.calculator.apply(u,[n])}:function(e){return e.length};r.error(function(){m.apply(N,arguments)});r.display(function(f){var c,h,p,d;p=l(f.indexes);if(n.force||1<p)for(c=0;c<a.length;c++)a[c]<=p&&(h=o[a[c]]);h?(d=h.offset||[-h.width/2,-h.height/2],c=e.extend({},s),c.options=e.extend({pane:"overlayLayer",content:h.content?h.content.replace("CLUSTER_COUNT",p):"",offset:{x:("x"in d?d.x:d[0])||0,y:("y"in d?d.y:d[1])||0}},s.options||{}),p=N.overlay({todo:c,opts:c.options,latLng:w(f)},!0),c.options.pane="floatShadow",c.options.content=e(document.createElement("div")).width(h.width+"px").height(h.height+"px").css({cursor:"pointer"}),shadow=N.overlay({todo:c,opts:c.options,latLng:w(f)},!0),s.data={latLng:w(f),markers:[]},e.each(f.indexes,function(e,t){s.data.markers.push(r.value(t));r.markerIsSet(t)&&r.marker(t).setMap(null)}),i(u,{todo:s},shadow,t,{main:p,shadow:shadow}),r.store(f,p,shadow)):e.each(f.indexes,function(e,t){r.marker(t).setMap(O)})});return r}var N=this,C=new s,L=new d,O=null,M;this._plan=function(e){for(var t=0;t<e.length;t++)C.add(new o(N,c,e[t]));f()};this.map=function(e){S(e.latLng,e);i(u,e,O);b(e,O)};this.destroy=function(e){L.clear();u.empty();O&&(O=null);b(e,!0)};this.infowindow=function(n){var r=[],s="values"in n.todo;s||(n.latLng&&(n.opts.position=n.latLng),n.todo.values=[{options:n.opts}]);e.each(n.todo.values,function(e,o){var f,l,c=a(n,o);c.options.position=c.options.position?w(c.options.position):w(o.latLng);O||S(c.options.position);(l=new k.classes.InfoWindow(c.options))&&(c.open===t||c.open)&&(s?l.open(O,c.anchor?c.anchor:t):l.open(O,c.anchor?c.anchor:n.latLng?t:n.session.marker?n.session.marker:t));r.push(l);f=L.add({todo:c},"infowindow",l);i(u,{todo:c},l,f)});b(n,s?r:r[0])};this.circle=function(t){var n=[],r="values"in t.todo;r||(t.opts.center=t.latLng||w(t.opts.center),t.todo.values=[{options:t.opts}]);t.todo.values.length?(e.each(t.todo.values,function(e,r){var s,o,f=a(t,r);f.options.center=f.options.center?w(f.options.center):w(r);O||S(f.options.center);f.options.map=O;o=new k.classes.Circle(f.options);n.push(o);s=L.add({todo:f},"circle",o);i(u,{todo:f},o,s)}),b(t,r?n:n[0])):b(t,!1)};this.overlay=function(t,n){var r=[],s="values"in t.todo;s||(t.todo.values=[{latLng:t.latLng,options:t.opts}]);if(t.todo.values.length){l.__initialised||(l.prototype=new k.classes.OverlayView,l.__initialised=!0);e.each(t.todo.values,function(s,o){var f,c,h=a(t,o);f=e(document.createElement("div")).css({border:"none",borderWidth:"0px",position:"absolute"});f.append(h.options.content);c=new l(O,h.options,w(h)||w(o),f);r.push(c);n||(f=L.add(t,"overlay",c),i(u,{todo:h},c,f))});if(n)return r[0];b(t,s?r:r[0])}else b(t,!1)};this.getaddress=function(e){g(e,e.results,e.status);M.ack()};this.getlatlng=function(e){g(e,e.results,e.status);M.ack()};this.getmaxzoom=function(e){A.maxZoomService||(A.maxZoomService=new google.maps.MaxZoomService);A.maxZoomService.getMaxZoomAtLatLng(e.latLng,function(t){g(e,t.status===google.maps.MaxZoomStatus.OK?t.zoom:!1,status);M.ack()})};this.getelevation=function(e){var t,n=[],r=function(t,n){g(e,n===google.maps.ElevationStatus.OK?t:!1,n);M.ack()};if(e.latLng)n.push(e.latLng);else for(n=y(e.todo.locations||[]),t=0;t<n.length;t++)n[t]=w(n[t]);if(n.length)v().getElevationForLocations({locations:n},r);else{if(e.todo.path&&e.todo.path.length)for(t=0;t<e.todo.path.length;t++)n.push(w(e.todo.path[t]));n.length?v().getElevationAlongPath({path:n,samples:e.todo.samples},r):M.ack()}};this.defaults=function(t){e.each(t.todo,function(t,n){k[t]="object"==typeof k[t]?e.extend({},k[t],n):n});M.ack(!0)};this.rectangle=function(t){var n=[],r="values"in t.todo;r||(t.todo.values=[{options:t.opts}]);t.todo.values.length?(e.each(t.todo.values,function(e,r){var s,o,f=a(t,r);f.options.bounds=f.options.bounds?E(f.options.bounds):E(r);O||S(f.options.bounds.getCenter());f.options.map=O;o=new k.classes.Rectangle(f.options);n.push(o);s=L.add({todo:f},"rectangle",o);i(u,{todo:f},o,s)}),b(t,r?n:n[0])):b(t,!1)};this.polyline=function(e){x(e,"Polyline","path")};this.polygon=function(e){x(e,"Polygon","paths")};this.trafficlayer=function(e){S();var t=L.get("trafficlayer");t||(t=new k.classes.TrafficLayer,t.setMap(O),L.add(e,"trafficlayer",t));b(e,t)};this.bicyclinglayer=function(e){S();var t=L.get("bicyclinglayer");t||(t=new k.classes.BicyclingLayer,t.setMap(O),L.add(e,"bicyclinglayer",t));b(e,t)};this.groundoverlay=function(e){e.opts.bounds=E(e.opts.bounds);e.opts.bounds&&S(e.opts.bounds.getCenter());var t,n=new k.classes.GroundOverlay(e.opts.url,e.opts.bounds,e.opts.opts);n.setMap(O);t=L.add(e,"groundoverlay",n);b(e,n,t)};this.streetviewpanorama=function(t){t.opts.opts||(t.opts.opts={});t.latLng?t.opts.opts.position=t.latLng:t.opts.opts.position&&(t.opts.opts.position=w(t.opts.opts.position));t.todo.divId?t.opts.container=document.getElementById(t.todo.divId):t.opts.container&&(t.opts.container=e(t.opts.container).get(0));var n,r=new k.classes.StreetViewPanorama(t.opts.container,t.opts.opts);r&&O.setStreetView(r);n=L.add(t,"streetviewpanorama",r);b(t,r,n)};this.kmllayer=function(t){var n=[],s="values"in t.todo;s||(t.todo.values=[{options:t.opts}]);t.todo.values.length?(e.each(t.todo.values,function(e,s){var o,f,l=a(t,s);O||S();o=l.options;l.options.opts&&(o=l.options.opts,l.options.url&&(o.url=l.options.url));o.map=O;f=r("3.10")?new k.classes.KmlLayer(o):new k.classes.KmlLayer(o.url,o);n.push(f);o=L.add({todo:l},"kmllayer",f);i(u,{todo:l},f,o)}),b(t,s?n:n[0])):b(t,!1)};this.panel=function(n){S();var r,i=r=0,s,o=e(document.createElement("div"));o.css({position:"absolute",zIndex:1e3,visibility:"hidden"});n.opts.content&&(s=e(n.opts.content),o.append(s),u.first().prepend(o),n.opts.left!==t?r=n.opts.left:n.opts.right!==t?r=u.width()-s.width()-n.opts.right:n.opts.center&&(r=(u.width()-s.width())/2),n.opts.top!==t?i=n.opts.top:n.opts.bottom!==t?i=u.height()-s.height()-n.opts.bottom:n.opts.middle&&(i=(u.height()-s.height())/2),o.css({top:i,left:r,visibility:"visible"}));r=L.add(n,"panel",o);b(n,o,r)};this.marker=function(t){var r="values"in t.todo,s=!O;r||(t.opts.position=t.latLng||w(t.opts.position),t.todo.values=[{options:t.opts}]);if(t.todo.values.length)if(s&&S(),t.todo.cluster&&!O.getBounds())google.maps.event.addListenerOnce(O,"bounds_changed",function(){N.marker.apply(N,[t])});else if(t.todo.cluster){var o;t.todo.cluster instanceof p?(r=t.todo.cluster,o=L.getById(r.id(),!0)):(o=T(t.todo.cluster),r=new p(n(t.todo.id,!0),o),L.add(t,"clusterer",r,o));o.beginUpdate();e.each(t.todo.values,function(e,n){var r=a(t,n);r.options.position=r.options.position?w(r.options.position):w(n);r.options.map=O;s&&(O.setCenter(r.options.position),s=!1);o.add(r,n)});o.endUpdate();b(t,r)}else{var f=[];e.each(t.todo.values,function(e,n){var r,o,l=a(t,n);l.options.position=l.options.position?w(l.options.position):w(n);l.options.map=O;s&&(O.setCenter(l.options.position),s=!1);o=new k.classes.Marker(l.options);f.push(o);r=L.add({todo:l},"marker",o);i(u,{todo:l},o,r)});b(t,r?f:f[0])}else b(t,!1)};this.getroute=function(e){e.opts.origin=w(e.opts.origin,!0);e.opts.destination=w(e.opts.destination,!0);A.directionsService||(A.directionsService=new google.maps.DirectionsService);A.directionsService.route(e.opts,function(t,n){g(e,n==google.maps.DirectionsStatus.OK?t:!1,n);M.ack()})};this.directionsrenderer=function(t){t.opts.map=O;var n,r=new google.maps.DirectionsRenderer(t.opts);t.todo.divId?r.setPanel(document.getElementById(t.todo.divId)):t.todo.container&&r.setPanel(e(t.todo.container).get(0));n=L.add(t,"directionsrenderer",r);b(t,r,n)};this.getgeoloc=function(e){b(e,e.latLng)};this.styledmaptype=function(e){S();var t=new k.classes.StyledMapType(e.todo.styles,e.opts);O.mapTypes.set(e.todo.id,t);b(e,t)};this.imagemaptype=function(e){S();var t=new k.classes.ImageMapType(e.opts);O.mapTypes.set(e.todo.id,t);b(e,t)};this.autofit=function(t){var n=new google.maps.LatLngBounds;e.each(L.all(),function(e,t){t.getPosition?n.extend(t.getPosition()):t.getBounds?(n.extend(t.getBounds().getNorthEast()),n.extend(t.getBounds().getSouthWest())):t.getPaths?t.getPaths().forEach(function(e){e.forEach(function(e){n.extend(e)})}):t.getPath?t.getPath().forEach(function(e){n.extend(e)}):t.getCenter?n.extend(t.getCenter()):t instanceof p&&(t=L.getById(t.id(),!0))&&t.autofit(n)});n.isEmpty()||O.getBounds()&&O.getBounds().equals(n)||("maxZoom"in t.todo&&google.maps.event.addListenerOnce(O,"bounds_changed",function(){this.getZoom()>t.todo.maxZoom&&this.setZoom(t.todo.maxZoom)}),O.fitBounds(n));b(t,!0)};this.clear=function(t){if("string"==typeof t.todo){if(L.clearById(t.todo)||L.objClearById(t.todo)){b(t,!0);return}t.todo={name:t.todo}}t.todo.id?e.each(y(t.todo.id),function(e,t){L.clearById(t)||L.objClearById(t)}):(L.clear(y(t.todo.name),t.todo.last,t.todo.first,t.todo.tag),L.objClear(y(t.todo.name),t.todo.last,t.todo.first,t.todo.tag));b(t,!0)};this.exec=function(t){var n=this;e.each(y(t.todo.func),function(r,i){e.each(n.get(t.todo,!0,t.todo.hasOwnProperty("full")?t.todo.full:!0),function(e,t){i.call(u,t)})});b(t,!0)};this.get=function(n,r,i){var s,o,u=r?n:n.todo;r||(i=u.full);"string"==typeof u?(o=L.getById(u,!1,i)||L.objGetById(u),!1===o&&(s=u,u={})):s=u.name;"map"===s&&(o=O);o||(o=[],u.id?(e.each(y(u.id),function(e,t){o.push(L.getById(t,!1,i)||L.objGetById(t))}),e.isArray(u.id)||(o=o[0])):(e.each(s?y(s):[t],function(t,n){var r;u.first?(r=L.get(n,!1,u.tag,i))&&o.push(r):u.all?e.each(L.all(n,u.tag,i),function(e,t){o.push(t)}):(r=L.get(n,!0,u.tag,i))&&o.push(r)}),u.all||e.isArray(s)||(o=o[0])));o=e.isArray(o)||!u.all?o:[o];if(r)return o;b(n,o)};this.getdistance=function(e){var t;e.opts.origins=y(e.opts.origins);for(t=0;t<e.opts.origins.length;t++)e.opts.origins[t]=w(e.opts.origins[t],!0);e.opts.destinations=y(e.opts.destinations);for(t=0;t<e.opts.destinations.length;t++)e.opts.destinations[t]=w(e.opts.destinations[t],!0);A.distanceMatrixService||(A.distanceMatrixService=new google.maps.DistanceMatrixService);A.distanceMatrixService.getDistanceMatrix(e.opts,function(t,n){g(e,n===google.maps.DistanceMatrixStatus.OK?t:!1,n);M.ack()})};this.trigger=function(t){if("string"==typeof t.todo)google.maps.event.trigger(O,t.todo);else{var n=[O,t.todo.eventName];t.todo.var_args&&e.each(t.todo.var_args,function(e,t){n.push(t)});google.maps.event.trigger.apply(google.maps.event,n)}g(t);M.ack()}}function C(e){var t;if("object"===!typeof e||!e.hasOwnProperty("get"))return!1;for(t in e)if("get"!==t)return!1;return!e.get.hasOwnProperty("callback")}var k,L=0,A={},O=new function(){var e=[];this.get=function(t){if(e.length){var n,r,i,s,o,a=u(t);for(n=0;n<e.length;n++){s=e[n];o=a.length==s.keys.length;for(r=0;r<a.length&&o;r++)i=a[r],(o=i in s.request)&&(o="object"==typeof t[i]&&"equals"in t[i]&&"function"==typeof t[i]?t[i].equals(s.request[i]):t[i]===s.request[i]);if(o)return s.results}}};this.store=function(t,n){e.push({request:t,keys:u(t),results:n})}};e.fn.gmap3=function(){var t,n=[],r=[];k||(k={verbose:!1,queryLimit:{attempt:5,delay:250,random:250},classes:{Map:google.maps.Map,Marker:google.maps.Marker,InfoWindow:google.maps.InfoWindow,Circle:google.maps.Circle,Rectangle:google.maps.Rectangle,OverlayView:google.maps.OverlayView,StreetViewPanorama:google.maps.StreetViewPanorama,KmlLayer:google.maps.KmlLayer,TrafficLayer:google.maps.TrafficLayer,BicyclingLayer:google.maps.BicyclingLayer,GroundOverlay:google.maps.GroundOverlay,StyledMapType:google.maps.StyledMapType,ImageMapType:google.maps.ImageMapType},map:{mapTypeId:google.maps.MapTypeId.ROADMAP,center:[46.578498,2.457275],zoom:2},overlay:{pane:"floatPane",content:"",offset:{x:0,y:0}},geoloc:{getCurrentPosition:{maximumAge:6e4,timeout:5e3}}});for(t=0;t<arguments.length;t++)arguments[t]&&n.push(arguments[t]);n.length||n.push("map");e.each(this,function(){var t=e(this),i=t.data("gmap3");i||(i=new N(t),t.data("gmap3",i));1!==n.length||"get"!==n[0]&&!C(n[0])?i._plan(n):"get"===n[0]?r.push(i.get("map",!0)):r.push(i.get(n[0].get,!0,n[0].get.full))});return r.length?1===r.length?r[0]:r:this}})(jQuery);